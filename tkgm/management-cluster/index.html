<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Docs, code and samples for my own Tanzu gym"><link href=https://matteo-magni.github.io/tanzugym/tkgm/management-cluster/ rel=canonical><link href=../relocate-images/ rel=prev><link href=../workload-cluster/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.1.8"><title>TKG management cluster - The Tanzu Gym</title><link rel=stylesheet href=../../assets/stylesheets/main.ded33207.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.a0c5b2b5.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Metropolis,Avenir+Next,Helvetica+Neue,Arial,sans-serif:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Metropolis,Avenir Next,Helvetica Neue,Arial,sans-serif";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../assets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=light-blue data-md-color-accent=lime> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#tkg-management-cluster class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="The Tanzu Gym" class="md-header__button md-logo" aria-label="The Tanzu Gym" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13.95 13.5h-.23c-.18.11-.26.32-.18.5l.86 2.11c.83-.53 1.46-1.32 1.79-2.25l-2.23-.36h-.01m-3.45.29a.415.415 0 0 0-.38-.29h-.08l-2.22.37c.33.92.96 1.7 1.79 2.23l.85-2.07V14c.04-.05.04-.14.04-.21m1.83.81a.378.378 0 0 0-.51-.15c-.07.05-.12.08-.15.15h-.01l-1.09 1.97c.78.26 1.62.31 2.43.12.14-.03.29-.07.43-.12l-1.09-1.97h-.01m3.45-4.57L14.1 11.5l.01.03a.37.37 0 0 0-.04.53c.05.06.11.1.18.12l.01.01 2.17.62c.07-.97-.14-1.95-.65-2.78m-3.11.16c.01.21.18.37.39.36.08 0 .15-.02.21-.05h.01l1.83-1.31a4.45 4.45 0 0 0-2.57-1.24l.13 2.24m-1.94.31c.17.11.4.08.52-.09.05-.06.07-.13.08-.21h.01l.12-2.25c-.15.02-.3.05-.46.08-.8.18-1.54.58-2.12 1.16l1.84 1.31h.01m-.99 1.69c.2-.05.32-.26.26-.46 0-.08-.05-.14-.11-.19v-.01L8.21 10c-.52.86-.74 1.84-.63 2.82l2.16-.62v-.01m1.64.66.62.3.62-.3.15-.67-.43-.53h-.69l-.43.53.16.67m10.89 1.32L20.5 6.5c-.09-.42-.37-.76-.74-.94l-7.17-3.43c-.37-.17-.81-.17-1.19 0L4.24 5.56c-.37.18-.65.52-.74.94l-1.77 7.67c-.05.2-.05.4 0 .59.01.06.03.12.05.18.03.09.08.19.13.27.03.04.05.08.09.11l4.95 6.18c.02 0 .05.04.05.06.1.09.19.16.28.22.12.08.26.14.4.17.11.05.23.05.32.05h8.12c.07 0 .14-.03.2-.05.05-.01.1-.03.14-.04.04-.02.07-.03.11-.05.05-.02.1-.05.15-.08.12-.08.23-.18.33-.28l.15-.2 4.8-5.98c.1-.12.17-.25.22-.38.02-.06.04-.12.05-.18.05-.19.05-.4 0-.59m-7.43 2.99c.02.06.04.12.07.17-.04.08-.06.17-.03.26.12.24.23.46.38.68.08.11.16.23.24.34 0 .03.03.08.04.12.12.2.06.46-.15.59s-.47.05-.59-.15c-.01-.03-.02-.05-.03-.08-.02-.03-.04-.09-.06-.09-.05-.15-.09-.28-.12-.41-.09-.25-.17-.49-.3-.72a.375.375 0 0 0-.21-.14l-.08-.16c-1.29.48-2.7.48-3.97-.01l-.1.18c-.07.01-.14.04-.19.09-.14.24-.24.49-.33.77-.03.13-.07.26-.12.4-.02 0-.04.07-.06.1a.43.43 0 0 1-.81-.29c.01-.03.03-.05.04-.08.04-.03.04-.08.04-.11.09-.12.16-.23.24-.35.16-.21.29-.45.39-.69a.54.54 0 0 0-.03-.25l.07-.18a5.611 5.611 0 0 1-2.47-3.09l-.2.03a.388.388 0 0 0-.23-.09c-.27.05-.51.13-.77.22-.11.06-.24.11-.37.15-.03.01-.07.02-.13.03a.438.438 0 0 1-.54-.27c-.07-.23.04-.47.28-.55.02 0 .05-.01.08-.01v-.01h.01l.11-.02c.14-.04.28-.04.41-.04.26 0 .52-.06.77-.12.08-.05.14-.11.19-.19l.19-.05c-.21-1.36.1-2.73.86-3.87l-.14-.12c0-.09-.03-.18-.08-.25-.2-.17-.41-.32-.64-.45-.12-.06-.24-.13-.36-.21-.02-.02-.06-.05-.08-.07l-.01-.01c-.2-.16-.25-.42-.11-.63.09-.1.21-.15.35-.15.11.01.21.05.3.12l.09.07c.1.09.19.2.28.3.18.19.37.37.58.52.08.04.17.05.26.03l.15.11c.75-.8 1.73-1.36 2.8-1.6.25-.06.52-.1.78-.12l.01-.18a.45.45 0 0 0 .14-.23c.01-.26-.01-.52-.05-.77-.03-.13-.05-.27-.06-.41V5.1c-.02-.24.15-.45.39-.48s.44.15.47.38v.22c-.01.14-.03.28-.06.41-.04.25-.06.51-.05.77.02.1.07.17.14.22l.01.19c1.36.12 2.62.73 3.56 1.72l.16-.12c.09.02.18.01.26-.03.21-.15.41-.33.58-.52.09-.1.18-.2.28-.3.03-.02.07-.06.1-.06.17-.18.44-.18.59 0 .19.16.18.43 0 .6 0 .02-.03.04-.06.06a2.495 2.495 0 0 1-.44.28c-.23.13-.45.28-.64.45-.06.07-.09.15-.08.24l-.16.14a5.44 5.44 0 0 1 .88 3.86l.19.05c.04.08.11.14.19.18.25.07.51.11.77.14h.41c.03.03.08.04.12.05.24.03.4.25.37.49-.05.23-.24.4-.48.37-.03-.01-.07-.01-.07-.02v-.01c-.06 0-.1-.01-.14-.02-.13-.04-.25-.09-.36-.15-.26-.1-.5-.17-.77-.21-.09 0-.17 0-.23.08-.07-.01-.13-.02-.19-.03-.41 1.31-1.31 2.41-2.47 3.11Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Tanzu Gym </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> TKG management cluster </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=light-blue data-md-color-accent=lime aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=lime aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/matteo-magni/tanzugym title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> matteo-magni/tanzugym </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> HOME </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> Tanzu Kubernetes Grid </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="The Tanzu Gym" class="md-nav__button md-logo" aria-label="The Tanzu Gym" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13.95 13.5h-.23c-.18.11-.26.32-.18.5l.86 2.11c.83-.53 1.46-1.32 1.79-2.25l-2.23-.36h-.01m-3.45.29a.415.415 0 0 0-.38-.29h-.08l-2.22.37c.33.92.96 1.7 1.79 2.23l.85-2.07V14c.04-.05.04-.14.04-.21m1.83.81a.378.378 0 0 0-.51-.15c-.07.05-.12.08-.15.15h-.01l-1.09 1.97c.78.26 1.62.31 2.43.12.14-.03.29-.07.43-.12l-1.09-1.97h-.01m3.45-4.57L14.1 11.5l.01.03a.37.37 0 0 0-.04.53c.05.06.11.1.18.12l.01.01 2.17.62c.07-.97-.14-1.95-.65-2.78m-3.11.16c.01.21.18.37.39.36.08 0 .15-.02.21-.05h.01l1.83-1.31a4.45 4.45 0 0 0-2.57-1.24l.13 2.24m-1.94.31c.17.11.4.08.52-.09.05-.06.07-.13.08-.21h.01l.12-2.25c-.15.02-.3.05-.46.08-.8.18-1.54.58-2.12 1.16l1.84 1.31h.01m-.99 1.69c.2-.05.32-.26.26-.46 0-.08-.05-.14-.11-.19v-.01L8.21 10c-.52.86-.74 1.84-.63 2.82l2.16-.62v-.01m1.64.66.62.3.62-.3.15-.67-.43-.53h-.69l-.43.53.16.67m10.89 1.32L20.5 6.5c-.09-.42-.37-.76-.74-.94l-7.17-3.43c-.37-.17-.81-.17-1.19 0L4.24 5.56c-.37.18-.65.52-.74.94l-1.77 7.67c-.05.2-.05.4 0 .59.01.06.03.12.05.18.03.09.08.19.13.27.03.04.05.08.09.11l4.95 6.18c.02 0 .05.04.05.06.1.09.19.16.28.22.12.08.26.14.4.17.11.05.23.05.32.05h8.12c.07 0 .14-.03.2-.05.05-.01.1-.03.14-.04.04-.02.07-.03.11-.05.05-.02.1-.05.15-.08.12-.08.23-.18.33-.28l.15-.2 4.8-5.98c.1-.12.17-.25.22-.38.02-.06.04-.12.05-.18.05-.19.05-.4 0-.59m-7.43 2.99c.02.06.04.12.07.17-.04.08-.06.17-.03.26.12.24.23.46.38.68.08.11.16.23.24.34 0 .03.03.08.04.12.12.2.06.46-.15.59s-.47.05-.59-.15c-.01-.03-.02-.05-.03-.08-.02-.03-.04-.09-.06-.09-.05-.15-.09-.28-.12-.41-.09-.25-.17-.49-.3-.72a.375.375 0 0 0-.21-.14l-.08-.16c-1.29.48-2.7.48-3.97-.01l-.1.18c-.07.01-.14.04-.19.09-.14.24-.24.49-.33.77-.03.13-.07.26-.12.4-.02 0-.04.07-.06.1a.43.43 0 0 1-.81-.29c.01-.03.03-.05.04-.08.04-.03.04-.08.04-.11.09-.12.16-.23.24-.35.16-.21.29-.45.39-.69a.54.54 0 0 0-.03-.25l.07-.18a5.611 5.611 0 0 1-2.47-3.09l-.2.03a.388.388 0 0 0-.23-.09c-.27.05-.51.13-.77.22-.11.06-.24.11-.37.15-.03.01-.07.02-.13.03a.438.438 0 0 1-.54-.27c-.07-.23.04-.47.28-.55.02 0 .05-.01.08-.01v-.01h.01l.11-.02c.14-.04.28-.04.41-.04.26 0 .52-.06.77-.12.08-.05.14-.11.19-.19l.19-.05c-.21-1.36.1-2.73.86-3.87l-.14-.12c0-.09-.03-.18-.08-.25-.2-.17-.41-.32-.64-.45-.12-.06-.24-.13-.36-.21-.02-.02-.06-.05-.08-.07l-.01-.01c-.2-.16-.25-.42-.11-.63.09-.1.21-.15.35-.15.11.01.21.05.3.12l.09.07c.1.09.19.2.28.3.18.19.37.37.58.52.08.04.17.05.26.03l.15.11c.75-.8 1.73-1.36 2.8-1.6.25-.06.52-.1.78-.12l.01-.18a.45.45 0 0 0 .14-.23c.01-.26-.01-.52-.05-.77-.03-.13-.05-.27-.06-.41V5.1c-.02-.24.15-.45.39-.48s.44.15.47.38v.22c-.01.14-.03.28-.06.41-.04.25-.06.51-.05.77.02.1.07.17.14.22l.01.19c1.36.12 2.62.73 3.56 1.72l.16-.12c.09.02.18.01.26-.03.21-.15.41-.33.58-.52.09-.1.18-.2.28-.3.03-.02.07-.06.1-.06.17-.18.44-.18.59 0 .19.16.18.43 0 .6 0 .02-.03.04-.06.06a2.495 2.495 0 0 1-.44.28c-.23.13-.45.28-.64.45-.06.07-.09.15-.08.24l-.16.14a5.44 5.44 0 0 1 .88 3.86l.19.05c.04.08.11.14.19.18.25.07.51.11.77.14h.41c.03.03.08.04.12.05.24.03.4.25.37.49-.05.23-.24.4-.48.37-.03-.01-.07-.01-.07-.02v-.01c-.06 0-.1-.01-.14-.02-.13-.04-.25-.09-.36-.15-.26-.1-.5-.17-.77-.21-.09 0-.17 0-.23.08-.07-.01-.13-.02-.19-.03-.41 1.31-1.31 2.41-2.47 3.11Z"/></svg> </a> The Tanzu Gym </label> <div class=md-nav__source> <a href=https://github.com/matteo-magni/tanzugym title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> matteo-magni/tanzugym </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> HOME </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Tanzu Kubernetes Grid <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Tanzu Kubernetes Grid </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Preface </a> </li> <li class=md-nav__item> <a href=../bastion/ class=md-nav__link> Prepare bastion host </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> Internal registry <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Internal registry </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../registry/ class=md-nav__link> Deployment and configuration </a> </li> <li class=md-nav__item> <a href=../relocate-images/ class=md-nav__link> Relocate TKG images </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> TKG management cluster <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> TKG management cluster </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#import-node-os-images class=md-nav__link> Import node OS images </a> </li> <li class=md-nav__item> <a href=#prepare-management-cluster-configuration class=md-nav__link> Prepare management cluster configuration </a> </li> <li class=md-nav__item> <a href=#prepare-the-tools class=md-nav__link> Prepare the tools </a> </li> <li class=md-nav__item> <a href=#deploy-the-management-cluster class=md-nav__link> Deploy the management cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../workload-cluster/ class=md-nav__link> TKG workload cluster </a> </li> <li class=md-nav__item> <a href=../ingress/ class=md-nav__link> Ingress controller </a> </li> <li class=md-nav__item> <a href=../identity-management/ class=md-nav__link> Identity management </a> </li> <li class=md-nav__item> <a href=../troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#import-node-os-images class=md-nav__link> Import node OS images </a> </li> <li class=md-nav__item> <a href=#prepare-management-cluster-configuration class=md-nav__link> Prepare management cluster configuration </a> </li> <li class=md-nav__item> <a href=#prepare-the-tools class=md-nav__link> Prepare the tools </a> </li> <li class=md-nav__item> <a href=#deploy-the-management-cluster class=md-nav__link> Deploy the management cluster </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=tkg-management-cluster>TKG management cluster<a class=headerlink href=#tkg-management-cluster title="Permanent link">&para;</a></h1> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The official VMware documentation is available at <a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/2.1/tkg-deploy-mc-21/mgmt-index.html>https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/2.1/tkg-deploy-mc-21/mgmt-index.html</a>.</p> </div> <h2 id=import-node-os-images>Import node OS images<a class=headerlink href=#import-node-os-images title="Permanent link">&para;</a></h2> <p>TKGm can be run either on Ubuntu or Photon VMs, whose base OS images are available on Customer Connect.</p> <div class=highlight><pre><span></span><code>❯<span class=w> </span>vcc<span class=w> </span>get<span class=w> </span>versions<span class=w> </span>-p<span class=w> </span>vmware_tanzu_kubernetes_grid<span class=w> </span>-s<span class=w> </span>tkg
...
FILENAME<span class=w>                                                                       </span>SIZE<span class=w>        </span>BUILD<span class=w> </span>NUMBER<span class=w>  </span>DESCRIPTION
...
photon-3-kube-v1.24.9+vmware.1-tkg.1-f5e94dab9dfbb9988aeb94f1ffdc6e5e.ova<span class=w>      </span><span class=m>1</span>.02<span class=w> </span>GB<span class=w>     </span><span class=m>21158328</span><span class=w>      </span>Photon<span class=w> </span>v3<span class=w> </span>Kubernetes<span class=w> </span>v1.24.9<span class=w> </span>OVA
photon-3-kube-v1.23.15+vmware.1-tkg.1-2d8c52b5e3dc2b7a03bf3a04815b9474.ova<span class=w>     </span><span class=m>1022</span>.45<span class=w> </span>MB<span class=w>  </span><span class=m>21158328</span><span class=w>      </span>Photon<span class=w> </span>v3<span class=w> </span>Kubernetes<span class=w> </span>v1.23.15<span class=w> </span>OVA
photon-3-kube-v1.22.17+vmware.1-tkg.1-a10ef8e088cc2c89418bca79a2fcc594.ova<span class=w>     </span><span class=m>1</span><span class=w> </span>GB<span class=w>        </span><span class=m>21158328</span><span class=w>      </span>Photon<span class=w> </span>v3<span class=w> </span>Kubernetes<span class=w> </span>v1.22.17<span class=w> </span>OVA
ubuntu-2004-kube-v1.24.9+vmware.1-tkg.1-b030088fe71fea7ff1ecb87a4d425c93.ova<span class=w>   </span><span class=m>1</span>.78<span class=w> </span>GB<span class=w>     </span><span class=m>21158328</span><span class=w>      </span>Ubuntu<span class=w> </span><span class=m>2004</span><span class=w> </span>Kubernetes<span class=w> </span>v1.24.9<span class=w> </span>OVA
ubuntu-2004-kube-v1.23.15+vmware.1-tkg.1-66940e9f3a5eda8bbd51042b1aaea6e1.ova<span class=w>  </span><span class=m>1</span>.74<span class=w> </span>GB<span class=w>     </span><span class=m>21158328</span><span class=w>      </span>Ubuntu<span class=w> </span><span class=m>2004</span><span class=w> </span>Kubernetes<span class=w> </span>v1.23.15<span class=w> </span>OVA
ubuntu-2004-kube-v1.22.17+vmware.1-tkg.1-df08b304658a6cf17f5e74dc0ab7543c.ova<span class=w>  </span><span class=m>1</span>.77<span class=w> </span>GB<span class=w>     </span><span class=m>21158328</span><span class=w>      </span>Ubuntu<span class=w> </span><span class=m>2004</span><span class=w> </span>Kubernetes<span class=w> </span>v1.22.17<span class=w> </span>OVA
...
</code></pre></div> <p>You might want to select the latest version of a particular flavour, to benefit from the latest updates and getting closer to the most recent upstream version. In this case, we're going to pick the Photon image for Kubernetes v1.24.9</p> <div class=highlight><pre><span></span><code>vcc<span class=w> </span>download<span class=w> </span>-p<span class=w> </span>vmware_tanzu_kubernetes_grid<span class=w> </span>-s<span class=w> </span>tkg<span class=w> </span>-v<span class=w> </span><span class=m>2</span>.1.0<span class=w> </span>-f<span class=w> </span><span class=s1>&#39;photon-3-kube-v1.24.9+vmware.1-tkg.1-f5e94dab9dfbb9988aeb94f1ffdc6e5e.ova&#39;</span><span class=w> </span>--accepteula
</code></pre></div> <p>and import it to our vSphere content library, to make sure it's available when needed.</p> <div class=highlight><pre><span></span><code>govc<span class=w> </span>library.import<span class=w> </span>-n<span class=w> </span>photon-1.24.9<span class=w> </span>ova<span class=w> </span><span class=nv>$HOME</span>/vcc-downloads/photon-3-kube-v1.24.9+vmware.1-tkg.1-f5e94dab9dfbb9988aeb94f1ffdc6e5e.ova
</code></pre></div> <p>However, TKGm expects a VM template to be available, therefore we need to deploy a template from this content library item. We dump the specs into a JSON file</p> <div class=highlight><pre><span></span><code>govc<span class=w> </span>import.spec<span class=w> </span><span class=nv>$HOME</span>/vcc-downloads/photon-3-kube-v1.24.9+vmware.1-tkg.1-f5e94dab9dfbb9988aeb94f1ffdc6e5e.ova<span class=w> </span>&gt;<span class=w> </span>photon.json
</code></pre></div> <p>and we edit it to make sure that</p> <ul> <li>it is marked as a template</li> <li>it does not get powered on</li> <li>the <code>DiskProvisioning</code> configuration is correct</li> </ul> <p>The result looks like this</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;DiskProvisioning&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;thin&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;IPAllocationPolicy&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;dhcpPolicy&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;IPProtocol&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;IPv4&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;NetworkMapping&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;Name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;nic0&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;Network&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>],</span>
<span class=w>  </span><span class=nt>&quot;Annotation&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Cluster API vSphere image - VMware Photon OS 64-bit and Kubernetes v1.24.9+vmware.1 - https://github.com/kubernetes-sigs/cluster-api-provider-vsphere&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;MarkAsTemplate&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;PowerOn&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;InjectOvfEnv&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;WaitForIP&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;Name&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>null</span>
<span class=p>}</span>
</code></pre></div> <p>Finally, we can deploy the OVA into a folder dedicated to our cluster</p> <div class=highlight><pre><span></span><code>govc<span class=w> </span>folder.create<span class=w> </span>/vc01/vm/tkgm
govc<span class=w> </span>library.deploy<span class=w> </span>-options<span class=w> </span>photon.json<span class=w> </span>-folder<span class=w> </span>tkgm<span class=w> </span>/ova/photon-1.24.9
</code></pre></div> <h2 id=prepare-management-cluster-configuration>Prepare management cluster configuration<a class=headerlink href=#prepare-management-cluster-configuration title="Permanent link">&para;</a></h2> <p>Tanzu Kubernetes Grid standalone cluster deployment can be run in unattended mode via the Tanzu CLI, feeding it with a <a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/2.1/tkg-deploy-mc-21/mgmt-deploy-file.html>YAML configuration file</a>. Alternatively, <a href=https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid/2.1/tkg-deploy-mc-21/mgmt-deploy-ui.html>a web UI is also available</a> for guiding the user through all the required settings.</p> <p>There is actually a third option, which is preferrable if you are not familiar with or not entirely sure about all the different settings available: it consists of using the web UI for generating the initial YAML file, and then fine tuning it, if needed, before submitting it to the Tanzu CLI. At this point, the YAMNL descriptor can also be stored in some git repo and used as a template for future installations.</p> <p>You use the Tanzu CLI to start the web UI</p> <div class=highlight><pre><span></span><code>tanzu<span class=w> </span>mc<span class=w> </span>create<span class=w> </span>--ui
</code></pre></div> <p>which by default will listen on <code>127.0.0.1:8080</code>. If you run it from the bastion host, you can either use the <code>--bind</code> flag or you need to create a ssh tunnel to the bastion like</p> <div class=highlight><pre><span></span><code>ssh<span class=w> </span>-l<span class=w> </span>&lt;BASTION-USER&gt;<span class=w> </span>-L<span class=w> </span><span class=m>8080</span>:localhost:8080<span class=w> </span>&lt;BASTION-HOST-IP-OR-FQDN&gt;
</code></pre></div> <p>and then direct your browser to <a href=http://localhost:8080>http://localhost:8080</a>.</p> <p>Now you can go through step-by-step process, providing the required information (i.e. vCenter endpoint and credentials, cluster details, ...). In the end, you review your configuration and are able to go back to change some bits; when everything looks good, you can go ahead and deploy the management cluster directly or export the generated YAML descriptor.</p> <p>Do make sure you export the file and go through it to get yourself comfortable with all the settings. Also, if you need to set up OIDC authentication, please take a look at the <a href=../identity-management/ >identity management document</a>.</p> <h2 id=prepare-the-tools>Prepare the tools<a class=headerlink href=#prepare-the-tools title="Permanent link">&para;</a></h2> <p>If you are planning to run TKGm in an isolated environment, you should have already <a href=../relocate-images/ >relocated all the images</a>, and now you need to make the Tanzu CLI aware of your internal registry. You can do so by setting the following variables:</p> <ul> <li><code>TKG_CUSTOM_IMAGE_REPOSITORY</code> stores the base URL of the images, which is <code>&lt;REGISTRY&gt;/&lt;PROJECT&gt;</code></li> <li><code>TKG_CUSTOM_IMAGE_REPOSITORY_CA_CERTIFICATE</code> stores the base64-encoded certificate of the CA that trusts the registry's certificate</li> </ul> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The value of <code>TKG_CUSTOM_IMAGE_REPOSITORY_CA_CERTIFICATE</code> MUST NOT contain newline characters.</p> </div> <p>These values can be set either as environment variables or Tanzu CLI's variables.</p> <div class="admonition note"> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Tanzu CLI variables (recommended)</label><label for=__tabbed_1_2>Environment variables</label></div> <div class=tabbed-content> <div class=tabbed-block> <p>You add the variables to the Tanzu CLI configuration, which is stored in a file thus persisted across different shells. This is the preferred method when your bastion host is used to manage only one management cluster or registry.</p> <div class=highlight><pre><span></span><code>tanzu<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>env.TKG_CUSTOM_IMAGE_REPOSITORY<span class=w> </span><span class=s2>&quot;&lt;REGISTRY-FQDN&gt;/tkg&quot;</span>
tanzu<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>env.TKG_CUSTOM_IMAGE_REPOSITORY_CA_CERTIFICATE<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>base64<span class=w> </span>-w0<span class=w> </span>/path/to/harbor-ca.pem<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <p>This is the preferred method if you have to deal with multiple environments with different configurations (i.e. different OCI registries), which is not this case.</p> <div class=highlight><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>TKG_CUSTOM_IMAGE_REPOSITORY</span><span class=o>=</span><span class=s2>&quot;&lt;REGISTRY-FQDN&gt;/tkg&quot;</span>
<span class=nb>export</span><span class=w> </span><span class=nv>TKG_CUSTOM_IMAGE_REPOSITORY_CA_CERTIFICATE</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>base64<span class=w> </span>-w0<span class=w> </span>&lt;<span class=w> </span>/path/to/harbor-ca.pem<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> </div> </div> </div> </div> <p>Do make sure your Docker client trusts the registry as explained in the <a href=../registry/#trust-your-registry>dedicated section</a>.</p> <h2 id=deploy-the-management-cluster>Deploy the management cluster<a class=headerlink href=#deploy-the-management-cluster title="Permanent link">&para;</a></h2> <p>It's finally time to build the management cluster.</p> <p>You need to add one more bit to your configuration file, otherwise the Tanzu CLI will prompt you for confirmation about deploying a management cluster on top of vSphere rather than an integrated vSphere with Tanzu (Tanzu Kubernetes Grid service).</p> <div class=highlight><pre><span></span><code><span class=nt>DEPLOY_TKG_ON_VSPHERE7</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> <p>Now you can create your management cluster as</p> <div class=highlight><pre><span></span><code>tanzu<span class=w> </span>mc<span class=w> </span>create<span class=w> </span>--file<span class=w> </span>/path/to/the/yaml/config/file<span class=w> </span>-v<span class=w> </span><span class=m>6</span>
</code></pre></div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2023-03-03 10:59:13</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Matteo Magni </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tabs.sticky", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.51198bba.min.js></script> </body> </html>