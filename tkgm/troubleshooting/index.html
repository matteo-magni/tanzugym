<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Docs, code and samples for my own Tanzu gym"><link href=https://matteo-magni.github.io/tanzugym/tkgm/troubleshooting/ rel=canonical><link href=../identity-management/ rel=prev><link href=../../tap/relocate-tap-images/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.3, mkdocs-material-9.1.18"><title>Troubleshooting - The Tanzu Gym</title><link rel=stylesheet href=../../assets/stylesheets/main.26e3688c.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ecc896b0.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Metropolis,Avenir+Next,Helvetica+Neue,Arial,sans-serif:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Metropolis,Avenir Next,Helvetica Neue,Arial,sans-serif";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../assets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=light-blue data-md-color-accent=lime> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#troubleshooting class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="The Tanzu Gym" class="md-header__button md-logo" aria-label="The Tanzu Gym" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13.95 13.5h-.23c-.18.11-.26.32-.18.5l.86 2.11c.83-.53 1.46-1.32 1.79-2.25l-2.23-.36h-.01m-3.45.29a.415.415 0 0 0-.38-.29h-.08l-2.22.37c.33.92.96 1.7 1.79 2.23l.85-2.07V14c.04-.05.04-.14.04-.21m1.83.81a.378.378 0 0 0-.51-.15c-.07.05-.12.08-.15.15h-.01l-1.09 1.97c.78.26 1.62.31 2.43.12.14-.03.29-.07.43-.12l-1.09-1.97h-.01m3.45-4.57L14.1 11.5l.01.03a.37.37 0 0 0-.04.53c.05.06.11.1.18.12l.01.01 2.17.62c.07-.97-.14-1.95-.65-2.78m-3.11.16c.01.21.18.37.39.36.08 0 .15-.02.21-.05h.01l1.83-1.31a4.45 4.45 0 0 0-2.57-1.24l.13 2.24m-1.94.31c.17.11.4.08.52-.09.05-.06.07-.13.08-.21h.01l.12-2.25c-.15.02-.3.05-.46.08-.8.18-1.54.58-2.12 1.16l1.84 1.31h.01m-.99 1.69c.2-.05.32-.26.26-.46 0-.08-.05-.14-.11-.19v-.01L8.21 10c-.52.86-.74 1.84-.63 2.82l2.16-.62v-.01m1.64.66.62.3.62-.3.15-.67-.43-.53h-.69l-.43.53.16.67m10.89 1.32L20.5 6.5c-.09-.42-.37-.76-.74-.94l-7.17-3.43c-.37-.17-.81-.17-1.19 0L4.24 5.56c-.37.18-.65.52-.74.94l-1.77 7.67c-.05.2-.05.4 0 .59.01.06.03.12.05.18.03.09.08.19.13.27.03.04.05.08.09.11l4.95 6.18c.02 0 .05.04.05.06.1.09.19.16.28.22.12.08.26.14.4.17.11.05.23.05.32.05h8.12c.07 0 .14-.03.2-.05.05-.01.1-.03.14-.04.04-.02.07-.03.11-.05.05-.02.1-.05.15-.08.12-.08.23-.18.33-.28l.15-.2 4.8-5.98c.1-.12.17-.25.22-.38.02-.06.04-.12.05-.18.05-.19.05-.4 0-.59m-7.43 2.99c.02.06.04.12.07.17-.04.08-.06.17-.03.26.12.24.23.46.38.68.08.11.16.23.24.34 0 .03.03.08.04.12.12.2.06.46-.15.59s-.47.05-.59-.15c-.01-.03-.02-.05-.03-.08-.02-.03-.04-.09-.06-.09-.05-.15-.09-.28-.12-.41-.09-.25-.17-.49-.3-.72a.375.375 0 0 0-.21-.14l-.08-.16c-1.29.48-2.7.48-3.97-.01l-.1.18c-.07.01-.14.04-.19.09-.14.24-.24.49-.33.77-.03.13-.07.26-.12.4-.02 0-.04.07-.06.1a.43.43 0 0 1-.81-.29c.01-.03.03-.05.04-.08.04-.03.04-.08.04-.11.09-.12.16-.23.24-.35.16-.21.29-.45.39-.69a.54.54 0 0 0-.03-.25l.07-.18a5.611 5.611 0 0 1-2.47-3.09l-.2.03a.388.388 0 0 0-.23-.09c-.27.05-.51.13-.77.22-.11.06-.24.11-.37.15-.03.01-.07.02-.13.03a.438.438 0 0 1-.54-.27c-.07-.23.04-.47.28-.55.02 0 .05-.01.08-.01v-.01h.01l.11-.02c.14-.04.28-.04.41-.04.26 0 .52-.06.77-.12.08-.05.14-.11.19-.19l.19-.05c-.21-1.36.1-2.73.86-3.87l-.14-.12c0-.09-.03-.18-.08-.25-.2-.17-.41-.32-.64-.45-.12-.06-.24-.13-.36-.21-.02-.02-.06-.05-.08-.07l-.01-.01c-.2-.16-.25-.42-.11-.63.09-.1.21-.15.35-.15.11.01.21.05.3.12l.09.07c.1.09.19.2.28.3.18.19.37.37.58.52.08.04.17.05.26.03l.15.11c.75-.8 1.73-1.36 2.8-1.6.25-.06.52-.1.78-.12l.01-.18a.45.45 0 0 0 .14-.23c.01-.26-.01-.52-.05-.77-.03-.13-.05-.27-.06-.41V5.1c-.02-.24.15-.45.39-.48s.44.15.47.38v.22c-.01.14-.03.28-.06.41-.04.25-.06.51-.05.77.02.1.07.17.14.22l.01.19c1.36.12 2.62.73 3.56 1.72l.16-.12c.09.02.18.01.26-.03.21-.15.41-.33.58-.52.09-.1.18-.2.28-.3.03-.02.07-.06.1-.06.17-.18.44-.18.59 0 .19.16.18.43 0 .6 0 .02-.03.04-.06.06a2.495 2.495 0 0 1-.44.28c-.23.13-.45.28-.64.45-.06.07-.09.15-.08.24l-.16.14a5.44 5.44 0 0 1 .88 3.86l.19.05c.04.08.11.14.19.18.25.07.51.11.77.14h.41c.03.03.08.04.12.05.24.03.4.25.37.49-.05.23-.24.4-.48.37-.03-.01-.07-.01-.07-.02v-.01c-.06 0-.1-.01-.14-.02-.13-.04-.25-.09-.36-.15-.26-.1-.5-.17-.77-.21-.09 0-.17 0-.23.08-.07-.01-.13-.02-.19-.03-.41 1.31-1.31 2.41-2.47 3.11Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> The Tanzu Gym </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Troubleshooting </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=light-blue data-md-color-accent=lime aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=lime aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/matteo-magni/tanzugym title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> matteo-magni/tanzugym </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> HOME </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> Tanzu Kubernetes Grid </a> </li> <li class=md-tabs__item> <a href=../../tap/relocate-tap-images/ class=md-tabs__link> Tanzu Application Platform </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="The Tanzu Gym" class="md-nav__button md-logo" aria-label="The Tanzu Gym" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13.95 13.5h-.23c-.18.11-.26.32-.18.5l.86 2.11c.83-.53 1.46-1.32 1.79-2.25l-2.23-.36h-.01m-3.45.29a.415.415 0 0 0-.38-.29h-.08l-2.22.37c.33.92.96 1.7 1.79 2.23l.85-2.07V14c.04-.05.04-.14.04-.21m1.83.81a.378.378 0 0 0-.51-.15c-.07.05-.12.08-.15.15h-.01l-1.09 1.97c.78.26 1.62.31 2.43.12.14-.03.29-.07.43-.12l-1.09-1.97h-.01m3.45-4.57L14.1 11.5l.01.03a.37.37 0 0 0-.04.53c.05.06.11.1.18.12l.01.01 2.17.62c.07-.97-.14-1.95-.65-2.78m-3.11.16c.01.21.18.37.39.36.08 0 .15-.02.21-.05h.01l1.83-1.31a4.45 4.45 0 0 0-2.57-1.24l.13 2.24m-1.94.31c.17.11.4.08.52-.09.05-.06.07-.13.08-.21h.01l.12-2.25c-.15.02-.3.05-.46.08-.8.18-1.54.58-2.12 1.16l1.84 1.31h.01m-.99 1.69c.2-.05.32-.26.26-.46 0-.08-.05-.14-.11-.19v-.01L8.21 10c-.52.86-.74 1.84-.63 2.82l2.16-.62v-.01m1.64.66.62.3.62-.3.15-.67-.43-.53h-.69l-.43.53.16.67m10.89 1.32L20.5 6.5c-.09-.42-.37-.76-.74-.94l-7.17-3.43c-.37-.17-.81-.17-1.19 0L4.24 5.56c-.37.18-.65.52-.74.94l-1.77 7.67c-.05.2-.05.4 0 .59.01.06.03.12.05.18.03.09.08.19.13.27.03.04.05.08.09.11l4.95 6.18c.02 0 .05.04.05.06.1.09.19.16.28.22.12.08.26.14.4.17.11.05.23.05.32.05h8.12c.07 0 .14-.03.2-.05.05-.01.1-.03.14-.04.04-.02.07-.03.11-.05.05-.02.1-.05.15-.08.12-.08.23-.18.33-.28l.15-.2 4.8-5.98c.1-.12.17-.25.22-.38.02-.06.04-.12.05-.18.05-.19.05-.4 0-.59m-7.43 2.99c.02.06.04.12.07.17-.04.08-.06.17-.03.26.12.24.23.46.38.68.08.11.16.23.24.34 0 .03.03.08.04.12.12.2.06.46-.15.59s-.47.05-.59-.15c-.01-.03-.02-.05-.03-.08-.02-.03-.04-.09-.06-.09-.05-.15-.09-.28-.12-.41-.09-.25-.17-.49-.3-.72a.375.375 0 0 0-.21-.14l-.08-.16c-1.29.48-2.7.48-3.97-.01l-.1.18c-.07.01-.14.04-.19.09-.14.24-.24.49-.33.77-.03.13-.07.26-.12.4-.02 0-.04.07-.06.1a.43.43 0 0 1-.81-.29c.01-.03.03-.05.04-.08.04-.03.04-.08.04-.11.09-.12.16-.23.24-.35.16-.21.29-.45.39-.69a.54.54 0 0 0-.03-.25l.07-.18a5.611 5.611 0 0 1-2.47-3.09l-.2.03a.388.388 0 0 0-.23-.09c-.27.05-.51.13-.77.22-.11.06-.24.11-.37.15-.03.01-.07.02-.13.03a.438.438 0 0 1-.54-.27c-.07-.23.04-.47.28-.55.02 0 .05-.01.08-.01v-.01h.01l.11-.02c.14-.04.28-.04.41-.04.26 0 .52-.06.77-.12.08-.05.14-.11.19-.19l.19-.05c-.21-1.36.1-2.73.86-3.87l-.14-.12c0-.09-.03-.18-.08-.25-.2-.17-.41-.32-.64-.45-.12-.06-.24-.13-.36-.21-.02-.02-.06-.05-.08-.07l-.01-.01c-.2-.16-.25-.42-.11-.63.09-.1.21-.15.35-.15.11.01.21.05.3.12l.09.07c.1.09.19.2.28.3.18.19.37.37.58.52.08.04.17.05.26.03l.15.11c.75-.8 1.73-1.36 2.8-1.6.25-.06.52-.1.78-.12l.01-.18a.45.45 0 0 0 .14-.23c.01-.26-.01-.52-.05-.77-.03-.13-.05-.27-.06-.41V5.1c-.02-.24.15-.45.39-.48s.44.15.47.38v.22c-.01.14-.03.28-.06.41-.04.25-.06.51-.05.77.02.1.07.17.14.22l.01.19c1.36.12 2.62.73 3.56 1.72l.16-.12c.09.02.18.01.26-.03.21-.15.41-.33.58-.52.09-.1.18-.2.28-.3.03-.02.07-.06.1-.06.17-.18.44-.18.59 0 .19.16.18.43 0 .6 0 .02-.03.04-.06.06a2.495 2.495 0 0 1-.44.28c-.23.13-.45.28-.64.45-.06.07-.09.15-.08.24l-.16.14a5.44 5.44 0 0 1 .88 3.86l.19.05c.04.08.11.14.19.18.25.07.51.11.77.14h.41c.03.03.08.04.12.05.24.03.4.25.37.49-.05.23-.24.4-.48.37-.03-.01-.07-.01-.07-.02v-.01c-.06 0-.1-.01-.14-.02-.13-.04-.25-.09-.36-.15-.26-.1-.5-.17-.77-.21-.09 0-.17 0-.23.08-.07-.01-.13-.02-.19-.03-.41 1.31-1.31 2.41-2.47 3.11Z"/></svg> </a> The Tanzu Gym </label> <div class=md-nav__source> <a href=https://github.com/matteo-magni/tanzugym title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> matteo-magni/tanzugym </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> HOME </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Tanzu Kubernetes Grid <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Tanzu Kubernetes Grid </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Preface </a> </li> <li class=md-nav__item> <a href=../bastion/ class=md-nav__link> Prepare bastion host </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> Internal registry <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Internal registry </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../registry/ class=md-nav__link> Deployment and configuration </a> </li> <li class=md-nav__item> <a href=../relocate-images/ class=md-nav__link> Relocate TKG images </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../management-cluster/ class=md-nav__link> TKG management cluster </a> </li> <li class=md-nav__item> <a href=../workload-cluster/ class=md-nav__link> TKG workload cluster </a> </li> <li class=md-nav__item> <a href=../ingress/ class=md-nav__link> Ingress controller </a> </li> <li class=md-nav__item> <a href=../identity-management/ class=md-nav__link> Identity management </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Troubleshooting <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Troubleshooting </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#change-kube-vip-ip-address class=md-nav__link> Change Kube-VIP IP address </a> </li> <li class=md-nav__item> <a href=#add-names-or-ips-to-api-server-certificate class=md-nav__link> Add names or IPs to API server certificate </a> </li> <li class=md-nav__item> <a href=#change-cluster-configuration class=md-nav__link> Change cluster configuration </a> </li> <li class=md-nav__item> <a href=#the-registry-throttles-the-upload-bundle-command class=md-nav__link> The registry throttles the upload-bundle command </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Tanzu Application Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tanzu Application Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tap/relocate-tap-images/ class=md-nav__link> Relocate TAP images </a> </li> <li class=md-nav__item> <a href=../../tap/add-tap-repository/ class=md-nav__link> Add TAP kapp repository </a> </li> <li class=md-nav__item> <a href=../../tap/relocate-tbs-dependencies/ class=md-nav__link> Relocate TBS dependencies </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#change-kube-vip-ip-address class=md-nav__link> Change Kube-VIP IP address </a> </li> <li class=md-nav__item> <a href=#add-names-or-ips-to-api-server-certificate class=md-nav__link> Add names or IPs to API server certificate </a> </li> <li class=md-nav__item> <a href=#change-cluster-configuration class=md-nav__link> Change cluster configuration </a> </li> <li class=md-nav__item> <a href=#the-registry-throttles-the-upload-bundle-command class=md-nav__link> The registry throttles the upload-bundle command </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h1> <!-- ## SSH into the nodes

## Nodes not joining the cluster --> <h2 id=change-kube-vip-ip-address>Change Kube-VIP IP address<a class=headerlink href=#change-kube-vip-ip-address title="Permanent link">&para;</a></h2> <p>You should never need to change the IP address of the Kube-VIP load balancer, because it is something you should carefully plan and decide upfront; but in case you do need it, this section may be helpful.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>This is a quite impactful operation, as it may (and will) break the connections between all the nodes. In the end you might also need to roll all the worker nodes out, for the change to be fully propagated. So, depending on your cluster size, get yourself a maintenance window long enough to rebuild all the nodes.</p> </div> <p>Do remember that you have to pick an address belonging to the same control-plane nodes network, and make sure it is outside the DHCP range.</p> <p>Kube-VIP is managed via a static pod running on the control-plane nodes, this means that its definition lies on a plain YAML file on the node's file system. For kubeadm-based clusters, the static pods manifest files are stored in the <code>/etc/kubernetes/manifests</code> directory, and TKG is no exception.</p> <p><a href=#ssh-into-the-nodes>Log into the control-plane nodes</a> and go to the manifests directory. Print the definition of the Kube-VIP pod, if you wish:</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>/etc/kubernetes/manifests
cat<span class=w> </span>kube-vip.yaml
</code></pre></div> <p>Now you need to edit the YAML file and set the value of the environment variable named <code>address</code> to the new IP address, like:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-vip</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>containers</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>args</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">manager</span>
<span class=w>    </span><span class=nt>env</span><span class=p>:</span>
<span class=nn>...</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">address</span>
<span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.31.8.12</span>
<span class=nn>...</span>
</code></pre></div> <p>Do the same thing on all the control-plane nodes of the cluster, and then delete all the <code>kube-vip-*</code> pods from the <code>kube-system</code> namespace, to get them recreated right away with the new configuration:</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-o<span class=w> </span>name<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>kube-vip-<span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>delete
</code></pre></div> <p>You also need to change the ConfigMap <code>kubeadm-config</code> in the <code>kube-system</code> namespace, to make sure that future nodes will get configured correctly. Set the key <code>controlPlaneEndpoint</code> in <code>data.ClusterConfiguration</code> to the new IP address, followed by <code>:6443</code> (the standard kube-api port does not change).</p> <h2 id=add-names-or-ips-to-api-server-certificate>Add names or IPs to API server certificate<a class=headerlink href=#add-names-or-ips-to-api-server-certificate title="Permanent link">&para;</a></h2> <p>If you want to reach out to your Kubernetes cluster using different DNS names and/or IP addresses (i.e. you need to <a href=#change-kube-vip-ip-address>change the Kube-VIP IP address</a>), you may also want to add those endpoints as <abbr title="Subject Alternative Names">SANs</abbr> in the API server certificate.</p> <p>First of all, you need to <a href=#ssh-into-the-nodes>log into the control-plane nodes via SSH</a> and <code>cd</code> to the <code>/etc/kubernetes/pki</code> directory. Here you can find all the certificates and keys used by Kubernetes, and the one you care about is <code>apiserver.crt</code>. You can actually take a look at it and make sure it does not include the new endpoints, yet:</p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>openssl<span class=w> </span>x509<span class=w> </span>-text<span class=w> </span>&lt;<span class=w> </span>apiserver.crt
</code></pre></div> <p>The <code>kubeadm</code> tool is used for the whole lifecycle of the cluster, and it comes in handy in this case, too. For example, you can check certificates expiration executing</p> <div class=highlight><pre><span></span><code>kubeadm<span class=w> </span>certs<span class=w> </span>check-expiration
</code></pre></div> <p>which shows you also which CA signed the certificates and whether it is external or not.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The following procedure applies when no external CA has been used to sign the API server certificate.</p> </div> <p>Kubeadm stores its configuration in a ConfigMap in the cluster, and that's where you start from to add the new endpoints. Fetch the ConfigMap contents and store it to a file:</p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>kubectl<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>get<span class=w> </span>cm<span class=w> </span>kubeadm-config<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.data.ClusterConfiguration}&#39;</span><span class=w> </span>--kubeconfig<span class=w> </span>/etc/kubernetes/admin.conf<span class=w> </span>&gt;<span class=w> </span>/tmp/kubeadm.conf
</code></pre></div> <p>Then, edit the <code>/tmp/kubeadm.conf</code> file to add (or edit if already present) the <code>apiServer.certSANs</code> key, as follows:</p> <div class=highlight><pre><span></span><code><span class=nt>apiServer</span><span class=p>:</span>
<span class=w>  </span><span class=nt>certSANs</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.31.8.12</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">my.cluster.endpoint.fqdn</span>
</code></pre></div> <p>Make sure you do remove the old certificate and key, otherwise <code>kubeadm</code> will not create a new one. Store them somewhere else rather than deleting them, just in case:</p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>mv<span class=w> </span>/etc/kubernetes/pki/apiserver.<span class=o>{</span>crt,key<span class=o>}</span><span class=w> </span>~
</code></pre></div> <p>Now run the command to build a new certificate and key pair:</p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>kubeadm<span class=w> </span>init<span class=w> </span>phase<span class=w> </span>certs<span class=w> </span>apiserver<span class=w> </span>--config<span class=w> </span>/tmp/kubeadm.conf
</code></pre></div> <p>The API server picks up the new certificate immediately and you can assert it includes the new <abbr title="Subject Alternative Names">SANs</abbr>.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>If the control-plane is composed of multiple nodes, do make sure you repeat the same process on all of them. <strong>DO NOT</strong> copy the certificate across all the nodes, as its <abbr title="Subject Alternative Names">SANs</abbr> include also the IP address of the node itself, which is unique for each node. However, you can feed the same <code>kubeadm.conf</code> file to the previous <code>kubeadm</code> command on all nodes.</p> </div> <p>Finally, upload the modified kubeadm configuration back to the ConfigMap in the cluster</p> <div class=highlight><pre><span></span><code>kubeadm<span class=w> </span>init<span class=w> </span>phase<span class=w> </span>upload-config<span class=w> </span>kubeadm<span class=w> </span>--config<span class=w> </span>/tmp/kubeadm.conf<span class=w> </span>--kubeconfig<span class=w> </span>/etc/kubernetes/admin.conf
</code></pre></div> <h2 id=change-cluster-configuration>Change cluster configuration<a class=headerlink href=#change-cluster-configuration title="Permanent link">&para;</a></h2> <p>The <code>Cluster</code> objects represent the actual Tanzu clusters known to the management cluster, both the management itself and the workload clusters. A change to those object forces all the nodes of the cluster (control-plane and worker nodes) to be rolled out with the new configuration.</p> <p>For example, if you need to apply or change the proxy settings to the cluster, you can add/change an item, similar to the following, to the <code>spec.topology.variables</code> list:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">proxy</span>
<span class=w>  </span><span class=nt>value</span><span class=p>:</span>
<span class=w>    </span><span class=nt>httpProxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://proxy.my.domain:proxy-port</span>
<span class=w>    </span><span class=nt>httpsProxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://proxy.my.domain:proxy-port</span>
<span class=w>    </span><span class=nt>noProxy</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.my.domain</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0/8</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.16.0.0/12</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.0/16</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.svc</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.svc.cluster.local</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100.96.0.0/11</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100.64.0.0/13</span>
</code></pre></div> <p>You can then observe the nodes as they get replaced.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Be aware that this will make the connection drop, as the Kube-VIP will need to be re-negotiated between the old and new node(s), so make sure you run this during a proper maintenance window.</p> </div> <!-- ## Provide custom CA certificates to Pinniped

If your OIDC IdP endpoint exposes a TLS certificate signed by an unknown authority (i.e. own company CA),
you need to provide the CA certificate to pinniped, otherwise the connection will fail.
Same thing if pinniped gets to the IdP endpoint via a TLS-enabled proxy that uses a custom CA --> <h2 id=the-registry-throttles-the-upload-bundle-command>The registry throttles the upload-bundle command<a class=headerlink href=#the-registry-throttles-the-upload-bundle-command title="Permanent link">&para;</a></h2> <p>The <code>tanzu isolated-cluster upload-bundle</code> command pushes multiple images in parallel to the registry, and this may cause congestion resulting in upload failures.</p> <p>As of now, the above command has no flags or modifiers (that I'm aware of) to decrease the number of parallel uploads, but you can manually push the images leveraging <code>imgpkg</code> directly.</p> <p>The <code>tanzu isolated-cluster download-bundle</code> command, used to pull the images, creates the <code>publish-images-fromtar.yaml</code> file to map every tar file to its correspondent OCI image path, and it looks like</p> <div class=highlight><pre><span></span><code><span class=nt>ako-operator-v1.7.0_vmware.3.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ako-operator</span>
<span class=nt>ako-v1.8.2_vmware.1.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ako</span>
<span class=nt>antrea-advanced-debian-v1.7.2_vmware.1.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">antrea-advanced-debian</span>
<span class=nt>azure-cloud-controller-manager-v1.1.26_vmware.1.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">azure-cloud-controller-manager</span>
<span class=nt>azure-cloud-controller-manager-v1.23.23_vmware.1.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">azure-cloud-controller-manager</span>
<span class=nt>azure-cloud-controller-manager-v1.24.10_vmware.1.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">azure-cloud-controller-manager</span>
<span class=nt>azure-cloud-node-manager-v1.1.26_vmware.1.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">azure-cloud-node-manager</span>
<span class=nt>azure-cloud-node-manager-v1.23.23_vmware.1.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">azure-cloud-node-manager</span>
<span class=nt>azure-cloud-node-manager-v1.24.10_vmware.1.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">azure-cloud-node-manager</span>
<span class=nt>calico-all-cni-v3.24.1_vmware.1.tar</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">calico-all/cni</span>
<span class=nn>...</span>
</code></pre></div> <p>So the following snippet can be used to parse this file and push the images sequentially:</p> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>/path/to/tkgm-bundle
yq<span class=w> </span>e<span class=w> </span><span class=s1>&#39;to_entries|map(&quot;imgpkg copy --tar &quot; + .key + &quot; --to-repo ${TKG_CUSTOM_IMAGE_REPOSITORY}/&quot; + .value + &quot; --registry-ca-cert-path /path/to/harbor-ca.pem&quot;)|.[]&#39;</span><span class=w> </span>publish-images-fromtar.yaml<span class=w> </span><span class=p>|</span><span class=w> </span>bash
</code></pre></div> <p>This script uses the same info as the <a href=../relocate-images/ >images relocation section</a>, like the <code>tkgm-bundle</code> directory and the <code>harbor-ca.pem</code> file.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2023-07-03 16:44:45</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Matteo Magni </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tabs.sticky", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.220ee61c.min.js></script> </body> </html>